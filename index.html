<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Escala Fácil - Limpeza da Sala</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    max-width: 700px;
  }
  h1 {
    color: #2c3e50;
  }
  button, input, select {
    padding: 10px 15px;
    margin-top: 10px;
    cursor: pointer;
    font-size: 16px;
  }
  #resultado {
    margin-top: 30px;
    font-size: 18px;
  }
  #resultado ul {
    list-style: none;
    padding: 0;
  }
  #resultado li {
    background: #ecf0f1;
    margin-bottom: 10px;
    padding: 12px;
    border-radius: 6px;
  }
  #perguntaQuemLimpouUltima, #perguntaLimpeza {
    margin-top: 20px;
  }
  #mensagemErro {
    color: red;
    margin-top: 10px;
  }
</style>
</head>
<body>

<h1>Escala Fácil - Limpeza da Sala</h1>

<div id="perguntaLimpeza">
  <label>Alguém já limpou o laboratório hoje?</label><br/>
  <button id="btnSim">Sim</button>
  <button id="btnNao">Não</button>
</div>

<div id="perguntaQuemLimpouUltima" style="display:none;">
  <p>Quem da última escala limpou hoje?</p>
  <form id="formQuemLimpou">
    <input type="radio" name="quemLimpou" value="nenhum" id="nenhum" checked />
    <label for="nenhum">Nenhum</label><br/>
    <input type="radio" name="quemLimpou" id="pessoa1" />
    <label for="pessoa1" id="labelPessoa1"></label><br/>
    <input type="radio" name="quemLimpou" id="pessoa2" />
    <label for="pessoa2" id="labelPessoa2"></label><br/>
    <button type="submit" style="margin-top:10px;">Confirmar</button>
  </form>
</div>

<button id="btnGerar" style="display:none;">Gerar escala de hoje</button>

<div id="resultado"></div>

<script>
  // Lista fixa dos nomes, ordem alfabética
  const nomes = [
    "Ana", "Bruno", "Carlos", "Daniela", "Eduardo", "Fernanda",
    "Gustavo", "Helena", "Igor", "João", "Karen", "Lucas",
    "Mariana", "Natália", "Otávio", "Paula", "Ricardo", "Sofia",
    "Thiago", "Úrsula", "Vinícius", "Wesley", "Xênia", "Yara", "Zé"
  ].sort((a,b) => a.localeCompare(b));

  // Dados salvos
  let jaLimpouHoje = JSON.parse(localStorage.getItem('jaLimpouHoje') || '[]');
  let historicoTarefa = JSON.parse(localStorage.getItem('historicoTarefa') || '{}');
  let posicaoUltimaEscala = JSON.parse(localStorage.getItem('posicaoUltimaEscala') || '-1');
  let ultimaEscala = JSON.parse(localStorage.getItem('ultimaEscala') || '[]');

  // Elementos DOM
  const perguntaLimpezaDiv = document.getElementById('perguntaLimpeza');
  const perguntaQuemLimpouUltimaDiv = document.getElementById('perguntaQuemLimpouUltima');
  const btnGerar = document.getElementById('btnGerar');
  const resultadoDiv = document.getElementById('resultado');
  const formQuemLimpou = document.getElementById('formQuemLimpou');
  const labelPessoa1 = document.getElementById('labelPessoa1');
  const labelPessoa2 = document.getElementById('labelPessoa2');
  const inputPessoa1 = document.getElementById('pessoa1');
  const inputPessoa2 = document.getElementById('pessoa2');

  // Salva tudo no localStorage
  function salvarTudo() {
    localStorage.setItem('jaLimpouHoje', JSON.stringify(jaLimpouHoje));
    localStorage.setItem('historicoTarefa', JSON.stringify(historicoTarefa));
    localStorage.setItem('posicaoUltimaEscala', JSON.stringify(posicaoUltimaEscala));
    localStorage.setItem('ultimaEscala', JSON.stringify(ultimaEscala));
  }

  // Função para encontrar próximo índice pulando quem já limpou hoje
  function proximoIndiceAtual(atual) {
    let i = atual;
    for (let count=0; count < nomes.length; count++) {
      i = (i + 1) % nomes.length;
      if (!jaLimpouHoje.includes(nomes[i])) return i;
    }
    return -1; // todos limparam hoje
  }

  // Reseta o dia se todos limparam
  function resetarDia() {
    jaLimpouHoje = [];
    historicoTarefa = {};
    posicaoUltimaEscala = -1;
    ultimaEscala = [];
    salvarTudo();
  }

  // Atualiza as opções da pergunta "Quem limpou?"
  function atualizarPerguntaQuemLimpou() {
    if (ultimaEscala.length !== 2) {
      // Se não tem última escala, pula essa pergunta
      perguntaQuemLimpouUltimaDiv.style.display = 'none';
      btnGerar.style.display = 'inline-block';
      return;
    }
    labelPessoa1.textContent = ultimaEscala[0];
    labelPessoa2.textContent = ultimaEscala[1];
    inputPessoa1.value = ultimaEscala[0];
    inputPessoa2.value = ultimaEscala[1];
    perguntaQuemLimpouUltimaDiv.style.display = 'block';
    btnGerar.style.display = 'none';
  }

  // Função para gerar a escala
  function gerarEscala() {
    resultadoDiv.innerHTML = '';

    // Se todo mundo limpou, resetar
    if (jaLimpouHoje.length >= nomes.length) {
      resultadoDiv.innerHTML = '<p>Todos já limparam hoje! Reiniciando escala...</p>';
      resetarDia();
      setTimeout(gerarEscala, 1500);
      return;
    }

    // Selecionar duas pessoas seguindo a ordem circular pulando quem já limpou
    const index1 = proximoIndiceAtual(posicaoUltimaEscala);
    if (index1 === -1) {
      // Todos limparam, resetar
      resultadoDiv.innerHTML = '<p>Todos já limparam hoje! Reiniciando escala...</p>';
      resetarDia();
      setTimeout(gerarEscala, 1500);
      return;
    }
    const index2 = proximoIndiceAtual(index1);
    if (index2 === -1) {
      // Só sobrou uma pessoa
      index2 = index1;
    }

    const selecionados = [nomes[index1], nomes[index2]];

    // Atualiza a posição da última escala para continuar o ciclo
    posicaoUltimaEscala = index2;

    // Função para alternar tarefa para a próxima vez
    function proximaTarefaAtual(nome) {
      if (!historicoTarefa[nome]) return 'chão';
      return historicoTarefa[nome] === 'chão' ? 'mesa' : 'chão';
    }

    // Atribuir tarefas fixas para esta escala:
    // Primeiro sempre chão, segundo sempre mesa
    const tarefas = [
      { nome: selecionados[0], tarefa: 'chão' },
      { nome: selecionados[1], tarefa: 'mesa' }
    ];

    // Atualizar histórico para próxima vez
    historicoTarefa[selecionados[0]] = tarefas[0].tarefa === 'chão' ? 'mesa' : 'chão';
    historicoTarefa[selecionados[1]] = tarefas[1].tarefa === 'chão' ? 'mesa' : 'chão';

    // Atualiza quem já limpou hoje
    jaLimpouHoje.push(selecionados[0]);
    if (selecionados[1] !== selecionados[0]) {
      jaLimpouHoje.push(selecionados[1]);
    }

    // Salva última escala
    ultimaEscala = selecionados.slice();

    salvarTudo();

    // Mostra resultado
    let html = '<h2>Escala de hoje:</h2><ul>';
    tarefas.forEach(t => {
      html += `<li>${t.nome} — limpar <strong>${t.tarefa}</strong></li>`;
    });
    html += '</ul>';

    resultadoDiv.innerHTML = html;

    // Esconde botão gerar e mostra pergunta "Quem limpou?"
    btnGerar.style.display = 'none';
    atualizarPerguntaQuemLimpou();
  }

  // Eventos

  // Quando clicar em "Sim" (alguém já limpou hoje)
  document.getElementById('btnSim').onclick = () => {
    perguntaLimpezaDiv.style.display = 'none';
    // Mostrar a pergunta "Quem limpou?"
    atualizarPerguntaQuemLimpou();
  };

  // Quando clicar em "Não"
  document.getElementById('btnNao').onclick = () => {
    perguntaLimpezaDiv.style.display = 'none';
    btnGerar.style.display = 'inline-block';
  };

  // Quando confirmar quem limpou da última escala
  formQuemLimpou.onsubmit = (e) => {
    e.preventDefault();
    const escolha = formQuemLimpou.quemLimpou.value;

    if (escolha === 'nenhum') {
      // Ninguém limpou, só mostrar botão gerar
      perguntaQuemLimpouUltimaDiv.style.display = 'none';
      btnGerar.style.display = 'inline-block';
    } else {
      // Marcar pessoa que limpou hoje para pular na próxima escala
      if (!jaLimpouHoje.includes(escolha)) {
        jaLimpouHoje.push(escolha);
        salvarTudo();
      }
      perguntaQuemLimpouUltimaDiv.style.display = 'none';
      btnGerar.style.display = 'inline-block';
    }
  };

  // Botão gerar escala
  btnGerar.onclick = gerarEscala;

</script>

</body>
</html>


</script>

</body>
</html>
