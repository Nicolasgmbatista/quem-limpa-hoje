<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Escala Fácil - Limpeza da Sala</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    max-width: 700px;
  }
  h1 {
    color: #2c3e50;
  }
  button, input, select {
    padding: 10px 15px;
    margin-top: 10px;
    cursor: pointer;
    font-size: 16px;
  }
  #resultado {
    margin-top: 30px;
    font-size: 18px;
  }
  #resultado ul {
    list-style: none;
    padding: 0;
  }
  #resultado li {
    background: #ecf0f1;
    margin-bottom: 10px;
    padding: 12px;
    border-radius: 6px;
  }
  #inputNomeLimpeza {
    margin-top: 10px;
    display: none;
  }
  #confirmaLimpeza {
    margin-top: 10px;
    display: none;
  }
  #mensagemErro {
    color: red;
    margin-top: 10px;
  }
</style>
</head>
<body>

<h1>Escala Fácil - Limpeza da Sala</h1>

<div id="perguntaLimpeza">
  <label>Alguém já limpou o laboratório hoje?</label><br/>
  <button id="btnSim">Sim</button>
  <button id="btnNao">Não</button>
</div>

<div id="inputNomeLimpeza">
  <label>Digite o nome da pessoa que já limpou:</label><br/>
  <input type="text" id="nomeLimpeza" list="listaNomes" placeholder="Nome exato"/>
  <datalist id="listaNomes">
    <!-- Opções inseridas via JS -->
  </datalist><br/>
  <button id="btnConfirmaNome">Confirmar</button>
  <button id="btnCancelarNome">Cancelar</button>
  <div id="mensagemErro"></div>
</div>

<button id="gerar" style="display:none;">Gerar escala de hoje</button>

<div id="resultado"></div>

<script>
  const nomes = [
    "Ana", "Bruno", "Carlos", "Daniela", "Eduardo", "Fernanda",
    "Gustavo", "Helena", "Igor", "João", "Karen", "Lucas",
    "Mariana", "Natália", "Otávio", "Paula", "Ricardo", "Sofia",
    "Thiago", "Úrsula", "Vinícius", "Wesley", "Xênia", "Yara", "Zé"
  ];

  // Históricos salvos no localStorage
  let historico = JSON.parse(localStorage.getItem('historicoLimpeza') || '{}');
  let jaLimpouHoje = JSON.parse(localStorage.getItem('jaLimpouHoje') || '[]');

  // Elementos DOM
  const perguntaLimpezaDiv = document.getElementById('perguntaLimpeza');
  const inputNomeLimpezaDiv = document.getElementById('inputNomeLimpeza');
  const gerarBtn = document.getElementById('gerar');
  const resultadoDiv = document.getElementById('resultado');
  const nomeLimpezaInput = document.getElementById('nomeLimpeza');
  const mensagemErroDiv = document.getElementById('mensagemErro');

  // Coloca nomes no datalist para ajudar a escolher
  function popularDatalist() {
    const datalist = document.getElementById('listaNomes');
    datalist.innerHTML = '';
    nomes.forEach(nome => {
      const option = document.createElement('option');
      option.value = nome;
      datalist.appendChild(option);
    });
  }

  popularDatalist();

  // Salva no localStorage
  function salvarHistorico() {
    localStorage.setItem('historicoLimpeza', JSON.stringify(historico));
  }
  function salvarJaLimpou() {
    localStorage.setItem('jaLimpouHoje', JSON.stringify(jaLimpouHoje));
  }

  // Ordena lista
  function ordenar(lista) {
    return lista.slice().sort((a,b) => a.localeCompare(b));
  }

  // Reseta dia (limpa históricos)
  function resetarDia() {
    historico = {};
    jaLimpouHoje = [];
    salvarHistorico();
    salvarJaLimpou();
  }

  // Próxima tarefa de uma pessoa
  function proximaTarefa(nome) {
    if (!historico[nome]) return "chão";
    return historico[nome] === "chão" ? "mesa" : "chão";
  }

  // Gera escala seguindo regra (1º chão, 2º mesa, etc)
  function gerarEscala() {
    resultadoDiv.innerHTML = '';

    const nomesOrdenados = ordenar(nomes);
    const disponiveis = nomesOrdenados.filter(nome => !jaLimpouHoje.includes(nome));

    if (disponiveis.length < 2) {
      resetarDia();
      resultadoDiv.innerHTML = '<p>Todos já limparam hoje! Reiniciando escala...</p>';
      setTimeout(gerarEscala, 1500);
      return;
    }

    const selecionados = disponiveis.slice(0, 2);

    const tarefas = [];

    // Primeiro sempre começa em chão
    const tarefa1 = historico[selecionados[0]] || 'chão';
    tarefas.push({ nome: selecionados[0], tarefa: tarefa1 });
    historico[selecionados[0]] = tarefa1 === 'chão' ? 'mesa' : 'chão';

    // Segundo sempre começa em mesa
    const tarefa2 = historico[selecionados[1]] || 'mesa';
    tarefas.push({ nome: selecionados[1], tarefa: tarefa2 });
    historico[selecionados[1]] = tarefa2 === 'chão' ? 'mesa' : 'chão';

    // Marca como já limpou
    jaLimpouHoje.push(selecionados[0], selecionados[1]);

    salvarHistorico();
    salvarJaLimpou();

    let html = '<h2>Pessoas para limpar hoje:</h2><ul>';
    tarefas.forEach(p => {
      html += `<li>${p.nome} — limpar <strong>${p.tarefa}</strong></li>`;
    });
    html += '</ul>';

    resultadoDiv.innerHTML = html;
  }

  // Botões "Sim" e "Não" da pergunta inicial
  document.getElementById('btnSim').onclick = () => {
    perguntaLimpezaDiv.style.display = 'none';
    inputNomeLimpezaDiv.style.display = 'block';
    gerarBtn.style.display = 'none';
    resultadoDiv.innerHTML = '';
  };

  document.getElementById('btnNao').onclick = () => {
    perguntaLimpezaDiv.style.display = 'none';
    inputNomeLimpezaDiv.style.display = 'none';
    gerarBtn.style.display = 'inline-block';
    resultadoDiv.innerHTML = '';
  };

  // Confirmar nome que limpou
  document.getElementById('btnConfirmaNome').onclick = () => {
    const nome = nomeLimpezaInput.value.trim();
    mensagemErroDiv.textContent = '';

    if (!nome) {
      mensagemErroDiv.textContent = 'Por favor, digite um nome.';
      return;
    }
    if (!nomes.includes(nome)) {
      mensagemErroDiv.textContent = 'Nome não encontrado na lista.';
      return;
    }
    if (jaLimpouHoje.includes(nome)) {
      mensagemErroDiv.textContent = 'Essa pessoa já foi marcada como limpou hoje.';
      return;
    }

    // Marca como já limpou hoje e mostra botão gerar
    jaLimpouHoje.push(nome);
    salvarJaLimpou();

    inputNomeLimpezaDiv.style.display = 'none';
    gerarBtn.style.display = 'inline-block';
    resultadoDiv.innerHTML = `<p>Marcado que <strong>${nome}</strong> já limpou hoje.</p>`;
  };

  // Cancelar marcar nome
  document.getElementById('btnCancelarNome').onclick = () => {
    inputNomeLimpezaDiv.style.display = 'none';
    gerarBtn.style.display = 'inline-block';
    resultadoDiv.innerHTML = '';
  };

  // Botão gerar escala
  gerarBtn.onclick = gerarEscala;
</script>

</body>
</html>
